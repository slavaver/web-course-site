---
number: "6"
title: "Classes, SSE"
type: "labs"
---

# Хранение данных на клиенте

**Цель:** получить базовые навыки создания реактивных интерфейсов, изучить работу с server-sent events, освоить использование классов.

## Изучить

- Функции-конструкторы, вызов функции с `new`, работу this.
- Прототипное наследование/делегирование.
- Создание классов и полей, методов в них, аксессоры. Создание экземпляров классов.
- Server-sent events, принцип работы, использование с EventSource.
- Паттерн наблюдатель.

## Источники

1. [Основы объектов в JavaScript](https://developer.mozilla.org/ru/docs/Learn/JavaScript/Objects/Basics)
1. [this](https://doka.guide/js/function-context/)
1. [Прототипы объектов](https://developer.mozilla.org/ru/docs/Learn/JavaScript/Objects/Object_prototypes)
1. [Классы](https://learn.javascript.ru/classes)
1. [Конструктор](https://learn.javascript.ru/constructor-new)
1. [Проверка класса: "instanceof"](https://learn.javascript.ru/instanceof)
1. [Чистый код](https://github.com/ryanmcdermott/clean-code-javascript?tab=readme-ov-file#classes)
1. [Использование server-sent events](https://developer.mozilla.org/ru/docs/Web/API/Server-sent_events/Using_server-sent_events)
1. [EventSource](https://developer.mozilla.org/ru/docs/Web/API/EventSource)
1. [Наблюдатель](<https://ru.wikipedia.org/wiki/%D0%9D%D0%B0%D0%B1%D0%BB%D1%8E%D0%B4%D0%B0%D1%82%D0%B5%D0%BB%D1%8C_(%D1%88%D0%B0%D0%B1%D0%BB%D0%BE%D0%BD_%D0%BF%D1%80%D0%BE%D0%B5%D0%BA%D1%82%D0%B8%D1%80%D0%BE%D0%B2%D0%B0%D0%BD%D0%B8%D1%8F)>)
1. [The Observer Pattern](https://www.oreilly.com/library/view/learning-javascript-design/9781449334840/ch09s05.html)
1. [Реактивность в программировании](https://doka.guide/tools/reactivity/)
1. [Patterns for Reactivity with Modern Vanilla JavaScript](https://frontendmasters.com/blog/vanilla-javascript-reactivity/)
1. [Reactive UI](https://css-tricks.com/reactive-uis-vanillajs-part-1-pure-functional-style/)

## Сделать

1. В документ index.html в папке lab6 подключите js файл.
1. Выполните задания описанные ниже и разместите в отдельных секциях с соответствующими подзаголовками.
1. Проведите ручное тестирование в браузере.
1. Проверьте валидность HTML и соответствие критериям доступности.
1. Отформатируйте документы.
1. Убедитесь, что нет замечаний от ESLint.
1. Зафиксируйте результаты работы с помощью системы контроля версий git и отправьте ветку main в репозиторий на github.
1. **Важное замечание** - с хостинга запросы не будут обрабатываться, так как мой сервер не работает по https.

## Задания

### Версионирование

Вам необходимо реализовать **функцию**-конструктор VersionManager. Она должна принимать необязательный параметр, представляющий начальную версию в формате MAJOR.MINOR.PATCH (например '1.2.4'). Если три составляющие не целые числа, то выбросите исключение "Некорректный формат версии!". Если исходная версия не указана или представляет собой пустую строку, по умолчанию используйте "0.0.1".

Объект должен поддерживать следующие методы (помните про свойство prototype), все из которых должны быть цепочечными (кроме release):

- major() - увеличить значение MAJOR на 1, установить значение MINOR и PATCH на 0
- minor() - увеличить значение MINOR на 1, установить значение PATCH на 0
- patch() - увеличить значение PATCH на 1
- rollback() - вернуть значения MAJOR, MINOR и PATCH к их значениям до предыдущего вызова major/minor/patch, или выдает исключение с сообщением "Невозможно выполнить откат!", если нет версии, к которой можно выполнить откат.
- release() - возвращает строку в формате MAJOR.MINOR.PATCH.

На странице в интерфейс добавьте поле для ввода версии и кнопку создания версии. При создании версии поле очищается, значение выводится текстом и появляются четыре кнопки для каждого метода. Нажатие на кнопку меняет значение, отображаемое текстом.

### Прямоугольник и квадрат

Реализуйте класс Rectangle с полями ширины и высоты. Добавьте методы для вычисления площади и периметра. Напишите класс Square, который наследуется от Rectangle, но у конструктора только один параметр - длина стороны.

На странице в интерфейс добавьте поля для ввода ширины и высоты и кнопки расчета периметра и площади. Если значения в полях равны, то создается экземпляр квадрата, если нет --- прямоугольника.

### Температура

Реализовать класс температуры (Temperature), который принимает значение температуры в градусах Цельсия. Если температура ниже -273.16 или выше 1.41e32, то выбросить исключение о неверном значении. Изменение значения температуры реализовать через сеттер, в котором проводится валидация указанного значения. Реализовать методы для конвертации температуры в градусы Кельвина и Фаренгейта возвращающие число с округлением до двух знаков. Реализовать метод toString, который возвращает строку с указанием температуры в градусах Кельвинах и К. Реализовать два статически метода для сложения и вычитания, которые принимают два экземпляра класса температуры и проверяют, что они относятся к этому классу и возвращают новый экземпляр класса температуры по вычисленному значению.

В интерфейсе создать поля для ввода двух значений температуры в градусах Цельсия, добавить радиокнопки для выбора градусов по Кельвину, Цельсию или Фаренгейту.

Рядом с полями в виде текста указывается введенная температура с округлением до двух знаков после запятой и с учетом выбранной единицы измерения. Если пользователь поменял выбор, то требуется обновить отображение значений.

Также нужны кнопки для сложения и вычитания значений.

### Камень-ножницы-бумага

Нужно создать интерфейс текстовой трансляции вечной битвы двух игроков в камень-ножницы-бумагу. Должна выводиться история раундов с момента загрузки страницы, количество побед каждого игрока, статистика по игроку (выбранные варианты).

Нажатие на кнопку "Следить за играми" создается экземпляр EventSource и начинается обработка поступающих данных. URL для EventSource - `http://95.163.242.125:80/rps/stream`. Событие: `round`, данные формата JSON `{player1: "Камень"/"Ножницы"/"Бумага", player2: "Камень"/"Ножницы"/"Бумага"}`.

Добавьте кнопку "Остановить", которая закрывает соединение.

Используйте паттерн наблюдатель, созданный через **классы** для обновления частей страницы по поступающим событиям из SSE.

В инструментах разработчика найдите вкладку Rendering (отрисовка) и поставьте галочку у пункта Paint Flashing. Это позволит вам видеть, что обновляется на вашей странице. Ваша задача чтобы при событии round обновлялись как можно меньшие части интерфейса. Если подкрашивается весь экран или секция с заданием, то это плохо.

### Требования к решению

- HTML код валиден.
- Отсутствуют ошибки ESLint.
- Отсутствуют ошибки в консоли браузера при работе с веб-страницей.

## Результаты выполнения лабораторной работы

Статическая веб-страница на локальной машине, со структурой и оформлением, которая соответствует требованиям и сохранена в системе контроля версий.

## Вопросы для защиты

1. Server-sent Events. Принцип работы, заголовки, формат сообщений.
1. Объект EventSource. Возможности, методы, события.
1. Идея реактивности при разработке пользовательских интерфейсов.
1. Шаблон наблюдатель (классы, поля, методы).
1. Функция-конструктор. Свойство prototype. Создание объекта.
1. Создание класса, наследование, задача функции super(), создание экземпляра класса.
1. Поля и методы классов. Приватные поля и методы, статические методы.
