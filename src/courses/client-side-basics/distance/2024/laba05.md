---
number: "5"
title: "Fetch"
type: "labs"
---

# Fetch API

**Цель:** получить навыки использования Fetch API и Storage, изучить формат обмена данными JSON.

## Изучить

- Изучите описание формата данных JSON и работу с ним с использованием глобального объекта JSON.
- Познакомьтесь с функцией `fetch()` и объектом `Response`.
- Прочитайте про async/await и связь асинхронных функций с объектом Promise.
- Изучите работу с localStorage.

## Источники

- [doka - fetch()](https://doka.guide/js/fetch/)
- [Fetch API](https://developer.mozilla.org/ru/docs/Web/API/Fetch_API)
- [RFC8259: The JavaScript Object Notation (JSON) Data Interchange Format](https://datatracker.ietf.org/doc/html/rfc8259)
- [ECMA-404: The JSON data interchange syntax](https://www.ecma-international.org/publications-and-standards/standards/ecma-404/)
- [ECMA-262: JSON5](https://262.ecma-international.org/11.0/#sec-json-object)
- [Хранение данных в браузере - learn js](https://learn.javascript.ru/data-storage)
- [Хранение данных в браузере - doka.guide](https://doka.guide/tools/browsers-storages/)
- [Client-side storage - MDN](https://developer.mozilla.org/ru/docs/Learn/JavaScript/Client-side_web_APIs/Client-side_storage)
- [Событие storage](https://learn.javascript.ru/localstorage#sobytie-storage)

## Сделать

1. В документ index.html в папке lab5 добавьте две секции: для галереи и отправки температуры.
1. Выполните задания описанные ниже.
1. Проведите ручное тестирование в браузере.
1. Отформатируйте документы.
1. Убедитесь, что нет замечаний от ESLint.
1. Зафиксируйте результаты работы с помощью системы контроля версий git и отправьте ветку main в репозиторий на github.
1. **Важное замечание** - с хостинга запросы не будут обрабатываться, так как мой сервер не работает по https.

### Тост

Создайте компонент всплывающего уведомления (toasts), который после отображается на странице внизу справа и показывает информацию. Закрывается он по нажатию на соответствующую кнопку. Отображение и скрытие должно происходить плавно. Также он должен иметь разные стили для отображения ошибки (красный фон) и сообщения (зеленый фон). Не забывайте про контрастность и доступность, а также про отзывчивость (RWD).

### Галерея

1. [Сервер с документацией](http://95.163.242.125:80/api/).
1. В галерее, используя AJAX, после загрузки страницы отправить запрос на получение изображений и отобразить их на странице. Если возникают какие-либо ошибки осуществить максимум 3 повторных запроса с небольшим интервалом. Если данные так и не удалось получить, то оповестить об этом пользователя с помощью компонента тоста. На время пока ожидается ответ от сервера, показать загрузчик, после получения ответа загрузчик должен замениться на контент или должно появится сообщение об ошибке. Если пришел пустой массив, то на месте галереи должен отображаться текст "Изображения не найдены".
1. В начало этой же секции, добавить кнопку обновления галереи, при нажатии на которую отправляет запрос на получение изображений.
1. Все блоки изображений с подписями должны выглядеть одинаково, не смотря на размер изображения или длину текста. В один ряд помещается 4-изображения (используйте grid).

### Температура

1. [Сервер с документацией](http://194.67.93.117:80/api/).
1. В этой секции добавьте форму для ввода номера аудитории и температуры. Не забудьте про доступность.
1. Для отправки данных из формы предотвратите стандартное поведение формы, сформируйте собственный post-запрос с помощью fetch. Не забудьте в заголовках указать тип передаваемого контента (Content-Type) и отправить данные с правильными типами (строка и число).
1. На время ожидания ответа от сервера заблокируйте возможность отправлять новые запросы из формы.
1. При успешной обработке данных на сервере с помощью тоста выведите сообщение из ответа и очистите форму. При ошибке, выведите сообщение ошибки в toast, но форму не очищайте.

### Переключение темы

Подготовьте минимальные стили для светлой и темной тем (цвета можно взять например у [DaisyUI в разделе List of themes](https://daisyui.com/docs/themes/)). Добавьте хедер к странице и в нем кнопку для переключения светлой и темной темы. При перезагрузке страницы должна отображаться последняя выбранная тема (подсказка - localStorage) и не происходило "мерцания" темы, когда сначала отображается одна тема, а потом подгружается сохраненная (подсказка - необходимо воспользоваться порядком загрузки и выполнения кода JS). Рекомендуется использовать css переменные и переключение классов.

### Требования к решению

- HTML код валиден.
- Отсутствуют ошибки ESLint.
- Отсутствуют ошибки в консоли браузера при работе с веб-страницей.

## Результаты выполнения лабораторной работы

Статическая веб-страница на локальной машине, со структурой и оформлением, которая соответствует требованиям и сохранена в системе контроля версий.

## Вопросы для защиты

1. Определение и назначение AJAX.
1. Fetch API (функция и ее параметры, используемые объекты).
1. Объект Response. Его свойства и методы.
1. Формат JSON. Глобальный объект JSON и его методы.
1. Хранение данных на клиенте.
1. localStorage и sessionStorage. Разница, их методы.
1. Асинхронные функции async/await. Возвращаемые значения.
1. Проблема "цветных" функций.
